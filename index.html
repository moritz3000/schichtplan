<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Goethebunker Schichtplanung</title>

  <style>
    :root {
      --primary-color: #2A2F3D;
      --secondary-color: #FF6B6B;
      --accent-color: #4ECDC4;
      --background-color: #F8F9FA;
      --text-color: #2A2F3D;
      --font-family: 'Inter', system-ui, -apple-system, sans-serif;
      --border-radius: 12px;
      --shadow: 0 8px 24px rgba(0,0,0,0.08);
      --transition: all 0.2s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
      padding-bottom: 80px;
    }

    header {
      background: linear-gradient(135deg, var(--primary-color) 0%, #1A1E27 100%);
      color: white;
      padding: 1rem 2rem;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .title {
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: -0.5px;
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 2rem;
    }

    /* Auth Section */
    .auth-card {
      background: white;
      border-radius: var(--border-radius);
      padding: 2.5rem;
      box-shadow: var(--shadow);
      max-width: 500px;
      margin: 2rem auto;
    }

    .auth-card h3 {
      margin-bottom: 1.5rem;
      color: var(--primary-color);
      font-size: 1.5rem;
      text-align: center;
    }

    .divider {
      text-align: center;
      margin: 1.5rem 0;
      position: relative;
      color: #6c757d;
    }

    .divider::before,
    .divider::after {
      content: "";
      flex: 1;
      border-bottom: 1px solid #dee2e6;
      position: absolute;
      top: 50%;
      width: 45%;
    }

    .divider::before {
      left: 0;
    }

    .divider::after {
      right: 0;
    }

    /* Form Elements */
    input, select {
      width: 100%;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border: 2px solid #e0e0e0;
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
    }

    input:focus, select:focus {
      border-color: var(--accent-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
    }

    .form-footer {
      margin: 1rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Buttons */
    button {
      padding: 1rem 1.5rem;
      border: none;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      justify-content: center;
    }

    .primary-btn {
      background: var(--accent-color);
      color: white;
    }

    .primary-btn:hover {
      background: #3FB4AD;
      transform: translateY(-1px);
    }

    .danger-btn {
      background: var(--secondary-color);
      color: white;
    }

    .danger-btn:hover {
      background: #FF5252;
    }

    /* Events */
    .event-card {
      background: white;
      border-radius: var(--border-radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
      position: relative;
      transition: var(--transition);
    }

    .event-card:hover {
      transform: translateY(-2px);
    }

    .event-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .event-title {
      color: var(--primary-color);
      font-size: 1.25rem;
      font-weight: 600;
    }

    .event-date {
      color: #6c757d;
      font-size: 0.9rem;
    }

    /* Availability Grid */
    .availability-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .name-item {
      background: #F1F3F5;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .remove-btn {
      background: var(--secondary-color);
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .remove-btn:hover {
      background: #FF5252;
    }

    /* Admin Section */
    .admin-section {
      margin-top: 3rem;
      background: white;
      padding: 2rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      margin: 1.5rem 0;
    }

    .admin-table th,
    .admin-table td {
      padding: 1rem;
      text-align: left;
    }

    .admin-table thead {
      background: var(--primary-color);
      color: white;
    }

    .admin-table tbody tr:nth-child(even) {
      background: #F8F9FA;
    }

    /* Notifications */
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 1rem 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      animation: slideIn 0.3s ease;
      color: white;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .notification-success {
      background: var(--accent-color);
    }

    .notification-error {
      background: var(--secondary-color);
    }

    .notification-info {
      background: #6c757d;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); }
      to { transform: translateX(0); }
    }

    /* Mobile Optimization */
    @media (max-width: 768px) {
      .container {
        padding: 0 1rem;
      }
      
      .auth-card {
        padding: 1.5rem;
      }
      
      .availability-grid {
        grid-template-columns: 1fr;
      }
      
      .admin-table {
        display: block;
        overflow-x: auto;
      }
      
      .event-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="title">Goethebunker Schichtplan</div>
      <div id="welcomeUser" style="display: none;"></div>
    </div>
  </header>

  <div id="notification"></div>

  <div class="container">
    <p id="currentDate" class="event-date"></p>

    <!-- Login/Register Section -->
    <div class="auth-card" id="authSection">
      <h3>Willkommen zurück</h3>
      <input type="email" id="emailInput" placeholder="E-Mail-Adresse">
      <input type="password" id="passwordLogin" placeholder="Passwort">

      <div class="form-footer">
        <input type="checkbox" id="staySignedIn">
        <label for="staySignedIn">Angemeldet bleiben</label>
      </div>

      <button class="primary-btn" id="loginButton">Anmelden</button>
      <div class="divider">oder</div>

      <h3>Neues Konto erstellen</h3>
      <input type="text" id="usernameRegister" placeholder="Benutzername">
      <input type="email" id="emailRegister" placeholder="E-Mail-Adresse">
      <input type="password" id="passwordRegister" placeholder="Passwort">
      <button class="primary-btn" id="registerButton">Registrieren</button>
    </div>

    <!-- Event Creation Form -->
    <form id="eventForm" class="admin-section" style="display: none;">
      <h3>Neues Event erstellen</h3>
      <select id="eventName" onchange="toggleOtherEvent()">
        <option value="">Event auswählen</option>
        <option value="Bunkernacht">Bunkernacht</option>
        <option value="Pferdreht">Pferdreht</option>
        <option value="IDOLS">IDOLS</option>
        <option value="sonstige">Sonstige</option>
      </select>

      <div id="otherEventContainer" style="display:none;">
        <input type="text" id="otherEvent" placeholder="Eventname eingeben">
      </div>

      <div style="display: grid; gap: 1rem; grid-template-columns: 1fr 1fr;">
        <div>
          <label>Datum</label>
          <input type="date" id="eventDate">
        </div>
        <div>
          <label>Startzeit</label>
          <input type="time" id="eventTime">
        </div>
      </div>

      <button type="button" class="primary-btn" onclick="addEvent()">Event erstellen</button>
    </form>

    <!-- Event Container -->
    <div id="eventContainer"></div>

    <!-- Admin Section -->
    <div id="adminSection" class="admin-section" style="display: none;">
      <h3>Verfügbarkeitsübersicht</h3>
      <table class="admin-table">
        <thead>
          <tr>
            <th>Datum</th>
            <th>Event</th>
            <th>Theke</th>
            <th>Garderobe</th>
            <th>Tür</th>
            <th>Kasse</th>
            <th>Schichtleitung</th>
          </tr>
        </thead>
        <tbody id="availabilityTable"></tbody>
      </table>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
        <button class="primary-btn" onclick="exportCSV()">CSV Export</button>
        <button class="danger-btn" id="manageUsersBtn" style="display: none;">Mitarbeiter verwalten</button>
      </div>
    </div>
  </div>

  <footer>
    <button id="logoutButton" class="danger-btn" style="display: none;">Abmelden</button>
  </footer>

  <!-- Firebase Implementation (Unverändert) -->
  <script type="module">
  
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-analytics.js";
    import {
      getFirestore, collection, addDoc, updateDoc, deleteDoc,
      doc, onSnapshot, query, where, arrayUnion, arrayRemove, getDocs
    } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";
    import {
      getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword,
      onAuthStateChanged, updateProfile, setPersistence,
      browserLocalPersistence, browserSessionPersistence
    } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";

    /* ===================
       Firebase-Konfig 
       =================== */
const firebaseConfig = {
  apiKey: "AIzaSyADch6nVtF-ljkPWvsae-rHEaiuKJSswY0",
  authDomain: "schichtplan-5c70f.firebaseapp.com",
  projectId: "schichtplan-5c70f",
  storageBucket: "schichtplan-5c70f.firebasestorage.app",
  messagingSenderId: "502149312331",
  appId: "1:502149312331:web:1dbce2d7fa034f25d702ce",
  measurementId: "G-0DL0R5B7LV"
};
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let loggedInUser = null;
    let loggedInEmail = null;
    let canRemove = false;
    let allEventsData = [];

    // Damit wir die Rollen der User kennen, um sie in CSV zuzuordnen
    let userRolesMap = {}; // email -> array of roles

    // Positions
    const POSITIONS = ["Theke","Garderobe","Tür","Kasse","Schichtleitung"];

    function setCurrentDate() {
      const el = document.getElementById('currentDate');
      const d = new Date();
      const opts = { day:'2-digit', month:'2-digit', year:'numeric', weekday:'long' };
      el.textContent = d.toLocaleDateString('de-DE', opts);
    }

    function showNotification(msg,type='success') {
      const notiBox = document.getElementById('notification');
      const div = document.createElement('div');
      div.className = 'notification-message';
      if(type==='error') div.classList.add('notification-error');
      else if(type==='info') div.classList.add('notification-info');
      div.textContent = msg;
      notiBox.appendChild(div);
      setTimeout(()=>{
        div.style.opacity='0';
        setTimeout(()=>div.remove(),500);
      },3000);
    }

    /* ===================
       Events rendern
       =================== */
    function renderEvents(data) {
      const container = document.getElementById('eventContainer');
      container.innerHTML = '';

      data.forEach(ev => {
        const div = document.createElement('div');
        div.className='event';

        const dateObj = new Date(ev.datum);
        const dateStr = dateObj.toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric',weekday:'long'}) || '';

        div.innerHTML=`
          <h3>${ev.name}</h3>
          ${canRemove ? `<button class="remove-event" onclick="removeEvent('${ev.id}')">x</button>` : ''}
          <p><strong>${dateStr}</strong> • Start: ${ev.startzeit || ''} Uhr</p>
        `;

        // Mitarbeiter
        const availabilityDiv = document.createElement('div');
        availabilityDiv.className='availability';
        (ev.mitarbeiter||[]).forEach(name=>{
          const nameSpan = document.createElement('span');
          nameSpan.className='name-item';
          nameSpan.textContent=name;
          if(canRemove){
            const remBtn = document.createElement('button');
            remBtn.className='remove';
            remBtn.textContent='x';
            remBtn.onclick=()=> removeName(ev.id,name);
            nameSpan.appendChild(remBtn);
          }
          availabilityDiv.appendChild(nameSpan);
        });
        div.appendChild(availabilityDiv);

        // Button "Ich kann arbeiten!"
        const confirmBtn = document.createElement('button');
        confirmBtn.style.width='auto';
        confirmBtn.style.display='inline-block';
        confirmBtn.textContent="Ich kann arbeiten!";
        confirmBtn.onclick=()=> confirmForEvent(ev.id);
        div.appendChild(confirmBtn);

        // Link "Kommentare" -> details-Seite
        const commentsLink = document.createElement('a');
        commentsLink.textContent="Kommentare";
        commentsLink.href=`eventDetails.html?id=${ev.id}`;
        commentsLink.style.position='absolute';
        commentsLink.style.bottom='10px';
        commentsLink.style.right='10px';
        commentsLink.style.fontSize='0.9em';
        commentsLink.style.color='#007bff';
        commentsLink.style.textDecoration='none';

        div.appendChild(commentsLink);
        container.appendChild(div);
      });
    }

    /* ===================
       Admin-Tabelle
       =================== */
    function renderAdminTable(data){
      const tbody = document.getElementById('availabilityTable');
      tbody.innerHTML='';

      data.forEach(ev=>{
        // Format Datum
        const dStr = new Date(ev.datum).toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric',weekday:'long'});
        const tr = document.createElement('tr');

        // (1) Datum
        const tdDate = document.createElement('td');
        tdDate.textContent=dStr;
        tr.appendChild(tdDate);

        // (2) Event
        const tdName = document.createElement('td');
        tdName.textContent= ev.name;
        tr.appendChild(tdName);

        // Dann pro Position eine Spalte
        POSITIONS.forEach(pos=>{
          const tdPos = document.createElement('td');
          // Filtere alle, die in ev.mitarbeiter enthalten sind und in userRolesMap die Rolle pos haben
          const matched = (ev.mitarbeiter||[]).filter(email=>{
            const roles= userRolesMap[email]||[];
            return roles.includes(pos);
          });
          if(matched.length>0){
            tdPos.textContent= matched.join(", ");
          } 
          tr.appendChild(tdPos);
        });

        tbody.appendChild(tr);
      });
    }

    /* ===================
       CSV-Export
       =================== */
    async function exportCSV(){
      if(!canRemove){
        showNotification('Nur Admin kann CSV exportieren','error');
        return;
      }
      if(!allEventsData.length){
        showNotification('Keine Events zum Exportieren','info');
        return;
      }
      try {
        // Lade alle User, baue rolesMap
        await loadAllUsersRoles();

        let csv="Datum;Event;";
        // Kopfzeile: Theke, Garderobe, Tür, Kasse, Schichtleitung
        POSITIONS.forEach(pos=>{
          csv+= pos+";";
        });
        csv+="\n";

        // Zeilen pro Event
        allEventsData.forEach(ev=>{
          // Datum
          const dObj= new Date(ev.datum);
          const dd= String(dObj.getDate()).padStart(2,'0');
          const mm= String(dObj.getMonth()+1).padStart(2,'0');
          const yy= dObj.getFullYear(); 
          const dateStr= `${dd}.${mm}.${yy}`;
          csv+= dateStr+";"+ ev.name+";";

          // Für jede Position => sammle die employees
          POSITIONS.forEach(pos=>{
            const matched= (ev.mitarbeiter||[]).filter(mail=>{
              const roles= userRolesMap[mail]||[];
              return roles.includes(pos);
            });
            if(matched.length){
              csv+= matched.join(",")+";";
            } else {
              csv+=";";
            }
          });
          csv+="\n";
        });

        // Download
        const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
        const url= URL.createObjectURL(blob);
        const link=document.createElement('a');
        link.href= url;
        link.setAttribute('download','verfuegbarkeiten_mit_rollen.csv');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } catch(err){
        console.error("CSV Fehler:", err);
        showNotification("Fehler beim CSV-Export: "+err.message,'error');
      }
    }

    // Lade alle user docs -> userRolesMap
    async function loadAllUsersRoles(){
      userRolesMap={};
      const snap= await getDocs(collection(db,"users"));
      snap.forEach(docS=>{
        const d= docS.data();
        // email -> roles
        userRolesMap[d.email]= d.roles||[];
      });
    }

    /* ===================
       Firestore-Listener
       =================== */
    function initializeAppData(){
      const coll=collection(db,"events");
      onSnapshot(coll,(snapshot)=>{
        const data=[];
        snapshot.forEach(docData=>{
          data.push({ id:docData.id, ...docData.data()});
        });
        allEventsData = data; 
        renderEvents(data);

        if(canRemove){
          document.getElementById('adminSection').style.display='block';
          // Wir zeigen Admin-Bereich erst, wenn wir user roles haben -> hier optional
          // Admin-Tabelle updaten -> erst user roles laden
          loadAllUsersRoles().then(()=>{
            renderAdminTable(data);
          });
        } else {
          document.getElementById('adminSection').style.display='none';
        }
      },(err)=>{
        console.error('Fehler beim Abrufen:',err);
        showNotification('Fehler beim Abrufen der Events','error');
      });
    }

    /* ===================
       Admin: neues Event
       =================== */
    async function addEvent(){
      if(!canRemove){
        showNotification('Nur Admin kann Events anlegen','error');
        return;
      }
      let eventNameVal = document.getElementById('eventName').value.trim();
      if(!eventNameVal){
        showNotification('Bitte Eventnamen angeben','error');
        return;
      }
      if(eventNameVal==='sonstige'){
        const otherVal = document.getElementById('otherEvent').value.trim();
        if(!otherVal){
          showNotification('Bitte sonstiges Event benennen','error');
          return;
        }
        eventNameVal = otherVal;
      }
      const eventDate = document.getElementById('eventDate').value;
      const eventTime = document.getElementById('eventTime').value;
      if(!eventDate || !eventTime){
        showNotification('Bitte Datum und Uhrzeit wählen','error');
        return;
      }
      try {
        const qy=query(collection(db,"events"),
          where("datum","==",eventDate),
          where("name","==",eventNameVal),
          where("startzeit","==",eventTime)
        );
        const snap=await getDocs(qy);
        if(!snap.empty){
          showNotification('Event existiert bereits','error');
          return;
        }
        await addDoc(collection(db,"events"),{
          datum:eventDate,
          name:eventNameVal,
          startzeit:eventTime,
          mitarbeiter:[],
          comments:[],
          importantInfo:""
        });
        showNotification('Event hinzugefügt');
        document.getElementById('eventForm').reset();
        document.getElementById('otherEventContainer').style.display='none';
      }catch(err){
        console.error('Fehler beim Hinzufügen',err);
        showNotification('Fehler beim Hinzufügen: '+err.message,'error');
      }
    }

    /* ===================
       Admin: Event löschen
       =================== */
    async function removeEvent(eventId){
      if(!canRemove)return;
      if(!confirm('Möchtest du dieses Event löschen?'))return;
      try {
        await deleteDoc(doc(db,"events",eventId));
        showNotification('Event gelöscht','info');
      }catch(err){
        console.error('Fehler beim Löschen',err);
        showNotification('Fehler beim Löschen: '+err.message,'error');
      }
    }

    /* ===================
       Nutzer: "Ich kann arbeiten!"
       =================== */
    async function confirmForEvent(eventId){
      if(!loggedInUser){
        showNotification('Bitte einloggen','error');
        return;
      }
      try {
        await updateDoc(doc(db,"events",eventId),{
          mitarbeiter:arrayUnion(loggedInUser)
        });
        showNotification('Du hast dich angemeldet.');
      }catch(err){
        console.error('Fehler beim Bestätigen',err);
        showNotification('Fehler: '+err.message,'error');
      }
    }

    /* ===================
       Admin: Mitarbeiter entfernen
       =================== */
    async function removeName(eventId,name){
      if(!canRemove)return;
      try {
        await updateDoc(doc(db,"events",eventId),{
          mitarbeiter:arrayRemove(name)
        });
        showNotification('Name entfernt.','info');
      }catch(err){
        console.error('Fehler beim Entfernen',err);
        showNotification('Fehler beim Entfernen: '+err.message,'error');
      }
    }

    /* ===================
       Auth
       =================== */
    onAuthStateChanged(auth,(user)=>{
      if(user){
        loggedInUser = user.displayName || user.email;
        loggedInEmail = user.email;
        canRemove = (user.email.toLowerCase()==='moritz@goethebunker.de');
        updateUIAfterLogin();
        initializeAppData();
      } else {
        loggedInUser=null;
        loggedInEmail=null;
        canRemove=false;
        updateUIAfterLogout();
      }
    });

    /* ===================
       Login / Register
       =================== */
    async function loginWithEmail(){
      const emailVal = document.getElementById('emailInput').value.trim();
      const pwVal = document.getElementById('passwordLogin').value;
      const staySigned = document.getElementById('staySignedIn').checked;

      if(!emailVal||!pwVal){
        showNotification('Bitte E-Mail und Passwort eingeben','error');
        return;
      }
      const pType = staySigned? browserLocalPersistence: browserSessionPersistence;
      try{
        await setPersistence(auth,pType);
        const cred = await signInWithEmailAndPassword(auth,emailVal,pwVal);
        const user= cred.user;
        canRemove = (user.email.toLowerCase()==='moritz@goethebunker.de');
        loggedInUser = user.displayName || user.email;
        showNotification(`${loggedInUser} ist eingeloggt.`,'success');
      }catch(err){
        console.error('Login Fehler',err);
        showNotification('Login Fehler: '+err.message,'error');
      }
    }
    async function registerWithEmail(){
      const nameVal = document.getElementById('usernameRegister').value.trim();
      const emailVal= document.getElementById('emailRegister').value.trim();
      const pwVal   = document.getElementById('passwordRegister').value;
      if(!nameVal||!emailVal||!pwVal){
        showNotification('Bitte Benutzername,E-Mail,Passwort.','error');
        return;
      }
      try{
        const cred= await createUserWithEmailAndPassword(auth,emailVal,pwVal);
        await updateProfile(cred.user,{ displayName: nameVal });
        // Optional: in "users" collection anlegen
        // roles: []
        await addDoc(collection(db,"users"),{
          email: emailVal,
          username: nameVal,
          roles:[]
        });
        showNotification('Registrierung erfolgreich. Bitte einloggen.','success');
      }catch(err){
        console.error('Reg Fehler',err);
        showNotification('Reg Fehler: '+err.message,'error');
      }
    }

    async function logout(){
      try{
        await auth.signOut();
        showNotification('Erfolgreich ausgeloggt','info');
      }catch(err){
        console.error('Logout Fehler',err);
        showNotification('Logout Fehler: '+err.message,'error');
      }
    }

    /* ===================
       UI
       =================== */
    function updateUIAfterLogin(){
      document.getElementById('authSection').style.display='none';
      document.getElementById('eventForm').style.display= canRemove ? 'block':'none';
      const userLabel = document.getElementById('welcomeUser');
      userLabel.textContent='Willkommen, '+loggedInUser+'!';
      userLabel.style.display='block';
      document.getElementById('logoutButton').style.display='inline-block';

      // Admin: "Mitarbeiter verwalten" (adminUsers.html)
      if(canRemove){
        document.getElementById('manageUsersBtn').style.display='inline-block';
      } else {
        document.getElementById('manageUsersBtn').style.display='none';
      }
    }
    function updateUIAfterLogout(){
      document.getElementById('authSection').style.display='block';
      document.getElementById('eventForm').style.display='none';
      document.getElementById('welcomeUser').style.display='none';
      document.getElementById('logoutButton').style.display='none';
      document.getElementById('adminSection').style.display='none';
      document.getElementById('eventContainer').innerHTML='';
    }

    function toggleOtherEvent(){
      const val = document.getElementById('eventName').value;
      document.getElementById('otherEventContainer').style.display= (val==='sonstige') ? 'block':'none';
    }

    /* ===================
       Start
       =================== */
    document.addEventListener('DOMContentLoaded',()=>{
      setCurrentDate();

      document.getElementById('loginButton').addEventListener('click',loginWithEmail);
      document.getElementById('registerButton').addEventListener('click',registerWithEmail);
      document.getElementById('logoutButton').addEventListener('click',logout);

      // Admin: "Mitarbeiter verwalten"
      document.getElementById('manageUsersBtn').addEventListener('click',()=>{
        window.location.href='adminUsers.html';
      });
    });

    // Für Inline
    window.removeEvent = removeEvent;
    window.removeName  = removeName;
    window.confirmForEvent = confirmForEvent;
    window.addEvent    = addEvent;
    window.toggleOtherEvent= toggleOtherEvent;
    window.exportCSV   = exportCSV;
  
    // Der Firebase-Code bleibt identisch zum ursprünglichen Code
    // (Hier aus Platzgründen gekürzt, muss aus der Originalversion übernommen werden)
  </script>
</body>
</html>